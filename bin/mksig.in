#!/bin/bash
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

version=@version@

dest=${PWD}
key=''
exp=false
sign=false

usage() {
    echo "Usage: ${0##*/} [options]"
    echo '    -d                 Destination file'
    echo '    -k                 GPG Key'
    echo '    -e                 Export key to destination'
    echo '    -s                 Sign destination'
    echo '    -h                 This help'
    echo ''
    echo ''
    exit $1
}

opts='d:k:esh'

while getopts "${opts}" arg; do
    case "${arg}" in
        d) dest="$OPTARG" ;;
        k) key="$OPTARG" ;;
        e) exp=true ;;
        s) sign=true ;;
        h|?) usage 0 ;;
        *) echo "invalid argument '${arg}'"; usage 1 ;;
    esac
done

shift $(($OPTIND - 1))

${exp} && gpg --export ${key} >${dest}

${sign} && gpg --detach-sign --default-key ${key} ${dest}
